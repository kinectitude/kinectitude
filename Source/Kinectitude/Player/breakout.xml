<?xml version="1.0" encoding="utf-8" ?>
<Game Name="breakout" Width="800" Height="600" FirstScene="game" IsFullScreen="false" xmlns="http://www.kinectitude.com/2012/v1">

  <Using File="Kinectitude.Kinect.dll">
    <Define Name="KinectFollowComponent" Class="Kinectitude.Kinect.KinectFollowComponent"/>
    <Define Name="KinectManager" Class="Kinectitude.Kinect.KinectManager"/>
    <Define Name="GestureEvent" Class="Kinectitude.Kinect.GestureEvent"/>
  </Using>

  <Using File="Kinectitude.Physics.dll">
    <Define Name="PhysicsManager" Class="Kinectitude.Physics.PhysicsManager"/>
    <Define Name="PhysicsComponent" Class="Kinectitude.Physics.PhysicsComponent"/>
    <Define Name="CrossesLineEvent" Class="Kinectitude.Physics.CrossesLineEvent"/>
    <Define Name="CollisionEvent" Class="Kinectitude.Physics.CollisionEvent"/>
  </Using>

  <Using File="Kinectitude.Render.dll">
    <Define Name="RenderManager" Class="Kinectitude.Render.RenderManager"/>
    <Define Name="RenderComponent" Class="Kinectitude.Render.RenderComponent"/>
    <Define Name="TextRenderComponent" Class="Kinectitude.Render.TextRenderComponent"/>
    <Define Name="ImageRenderComponent" Class="Kinectitude.Render.ImageRenderComponent" />
  </Using>

  <Using File="Kinectitude.Sound.dll">
    <Define Name="SoundManager" Class="Kinectitude.Sound.SoundManager"/>
    <Define Name="SoundComponent" Class="Kinectitude.Sound.SoundComponent"/>
    <Define Name="PlaySoundAction" Class="Kinectitude.Sound.PlaySoundAction"/>
    <Define Name="StopSoundAction" Class="Kinectitude.Sound.StopSoundAction"/>
  </Using>

  <Prototype Name="paddle">
    <Component Type="KinectFollowComponent" Direction="X" Player="1" Joint="HandRight"/>
    <Component Type="RenderComponent" FillColor="Black" Shape="Rectangle"/>
    <Component Type="PhysicsComponent" XVelocity="0" YVelocity="0" Shape="Rectangle" Restitution="0" Mass="1" Friction="0" LinearDamping="0" MovesWhenHit="false" FixedRotation="true"/>
    <Component Type="TransformComponent" Width="128" Height="24"/>
  </Prototype>

  <Prototype Name="ball" Value="0">
    <Component Type="RenderComponent" FillColor="Black" Shape="Rectangle" />
    <Component Type="TransformComponent" X="400" Y="550" Width="24" Height="24"/>
    <Component Type="PhysicsComponent" MinimumVelocity="50" MaximumVelocity="50" XVelocity="-40" YVelocity="-20" Shape="Ellipse" Restitution="1" Mass="1" Friction="0" LinearDamping="0" MovesWhenHit="true" FixedRotation="false" AngularVelocity="1"/>
    <Event Type="TriggerOccursEvent" Trigger="gameOver">
      <Action Type="DestroyAction"/>
    </Event>
  </Prototype>

  <Prototype Name="primaryBall" Prototype="ball">
    <Event Type="CollisionEvent" CollidesWith="bottom_wall">
      <Action Type="SetPositionAction" X="400" Y="300" />
      <Action Type="IncrementAction" Target="scene.balls" IncrementBy="-1"/>
    </Event>
  </Prototype>

  <Prototype Name="extraBall" Prototype="ball">
    <Event Type="CollisionEvent" CollidesWith="bottom_wall">
      <Action Type="DestroyAction"/>
    </Event>
  </Prototype>

  <Prototype Name="block">
    <Component Type="RenderComponent" FillColor="Red" Shape="Rectangle"/>
    <Component Type="PhysicsComponent" XVelocity="0" YVelocity="0" Shape="Rectangle" Restitution="0" Mass="1" Friction="0" LinearDamping="0" MovesWhenHit="false" FixedRotation="true"/>
    <Component Type="TransformComponent" Width="95" Height="20"/>
    <Component Type="SoundComponent" Filename="bottle_pop.wav" Looping="false"/>
    <Event Type="CollisionEvent" CollidesWith="$extraBall $primaryBall">
      <Action Type="IncrementAction" Target="scene.blocks" IncrementBy="-1"/>
      <Action Type="PlaySoundAction"/>
      <Action Type="DestroyAction" />
    </Event>
  </Prototype>

  <Prototype Name="spawn1Block" Prototype="block">
    <Component Type="RenderComponent" FillColor="Orange"/>
    <Event Type="CollisionEvent" CollidesWith="$extraBall $primaryBall">
      <Action Type="CreateEntityAction" Prototype="extraBall"/>
    </Event>
  </Prototype>

  <Prototype Name="spawn3Block" Prototype="block">
    <Component Type="RenderComponent" FillColor="Yellow"/>
    <Event Type="CollisionEvent" CollidesWith="$extraBall $primaryBall">
      <Action Type="CreateEntityAction" Prototype="extraBall"/>
      <Action Type="CreateEntityAction" Prototype="extraBall"/>
      <Action Type="CreateEntityAction" Prototype="extraBall"/>
    </Event>
  </Prototype>

  <Prototype Name="text">
    <Component Type="TextRenderComponent" FontFamily="Arial" FontWeight="Normal" FontStyle="Normal" FontStretch="Normal" FontSize="36" FontColor="White" />
  </Prototype>

  <Scene Name="game" balls="10" blocks="24">

    <Entity Name="player" Prototype="paddle">
      <Component Type="TransformComponent" X="400" Y="560"/>
    </Entity>

    <Entity Prototype="spawn3Block">
      <Component Type="TransformComponent" X="50" Y="200"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="150" Y="200"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="250" Y="200"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="350" Y="200"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="450" Y="200"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="550" Y="200"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="650" Y="200"/>
    </Entity>
    <Entity Prototype="spawn3Block">
      <Component Type="TransformComponent" X="750" Y="200"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="50" Y="225"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="150" Y="225"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="250" Y="225"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="350" Y="225"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="450" Y="225"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="550" Y="225"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="650" Y="225"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="750" Y="225"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="50" Y="250"/>
    </Entity>
    <Entity Prototype="spawn1Block">
      <Component Type="TransformComponent" X="150" Y="250"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="250" Y="250"/>
    </Entity>
    <Entity Prototype="spawn1Block">
      <Component Type="TransformComponent" X="350" Y="250"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="450" Y="250"/>
    </Entity>
    <Entity Prototype="spawn1Block">
      <Component Type="TransformComponent" X="550" Y="250"/>
    </Entity>
    <Entity Prototype="block">
      <Component Type="TransformComponent" X="650" Y="250"/>
    </Entity>
    <Entity Prototype="spawn1Block">
      <Component Type="TransformComponent" X="750" Y="250"/>
    </Entity>

    <Entity Name="top_wall">
      <Component Type="TransformComponent" X="400" Y="0" Width="800" Height="2"/>
      <Component Type="PhysicsComponent" XVelocity="0" YVelocity="0" Shape="Rectangle" Restitution="0" Mass="1" Friction="0" LinearDamping="0" MovesWhenHit="false" FixedRotation="true"/>
    </Entity>

    <Entity Name="bottom_wall">
      <Component Type="TransformComponent" X="400" Y="600" Width="800" Height="2"/>
      <Component Type="PhysicsComponent" XVelocity="0" YVelocity="0" Shape="Rectangle" Restitution="0" Mass="1" Friction="0" LinearDamping="0" MovesWhenHit="false" FixedRotation="true"/>
    </Entity>

    <Entity Name="left_wall">
      <Component Type="TransformComponent" X="0" Y="300" Width="2" Height="600"/>
      <Component Type="PhysicsComponent" XVelocity="0" YVelocity="0" Shape="Rectangle" Restitution="0" Mass="1" Friction="0" LinearDamping="0" MovesWhenHit="false" FixedRotation="true"/>
    </Entity>

    <Entity Name="right_wall">
      <Component Type="TransformComponent" X="800" Y="300" Width="2" Height="600"/>
      <Component Type="PhysicsComponent" XVelocity="0" YVelocity="0" Shape="Rectangle" Restitution="0" Mass="1" Friction="0" LinearDamping="0" MovesWhenHit="false"/>
    </Entity>

    <Entity Prototype="primaryBall">
      <Component Type="RenderComponent" FillColor="White"/>
    </Entity>

    <Entity>
      <Event Type="SceneStartsEvent">
        <Action Type="IncrementAction" Target="scene.blocks" IncrementBy="0"/> <!--Increment value by 0 just so the text shows up initially-->
      </Event>
    </Entity>

    <Entity Prototype="text">
      <Component Type="TransformComponent" X="0" Y="0" Width="800"/>
      <Component Type="TextRenderComponent" Value="" FontSize="20" TextAlignment="Center"/>
      <Event Type="AttributeChangesEvent" Target="{scene.balls} {scene.blocks}">
        <Action Type="SetAction" Target="TextRenderComponent.Value" Value="Extra balls: {scene.balls}"/>
        <Condition If="scene.blocks == 0">
          <Action Type="SetAction" Target="TextRenderComponent.Value" Value="YOU WIN!"/>
          <Action Type="FireTriggerAction" Name="gameOver"/>
        </Condition>
        <Condition If="scene.balls &lt; 0">
          <Action Type="SetAction" Target="TextRenderComponent.Value" Value="GAME OVER"/>
          <Action Type="FireTriggerAction" Name="gameOver"/>
        </Condition>
      </Event>
    </Entity>
  </Scene>
</Game>