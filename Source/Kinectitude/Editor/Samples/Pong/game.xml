<?xml version="1.0" encoding="utf-8" ?>
<Game xmlns="http://www.kinectitude.com/2012/v1" Name="Pong" Width="800" Height="600" FirstScene="Main Menu" IsFullScreen="false">
  
  <Using File="Kinect.dll">
    <Define Name="KinectComponent" Class="Kinectitude.Kinect.KinectComponent" />
    <Define Name="KinectFollowComponent" Class="Kinectitude.Kinect.KinectFollowComponent" />
    <Define Name="KinectManager" Class="Kinectitude.Kinect.KinectManager" />
  </Using>
  
  <Using File="Physics.dll">
    <Define Name="PhysicsComponent" Class="Kinectitude.Physics.PhysicsComponent" />
    <Define Name="PhysicsManager" Class="Kinectitude.Physics.PhysicsManager" />
    <Define Name="CrossesLineEvent" Class="Kinectitude.Physics.CrossesLineEvent" />
  </Using>
  
  <Using File="Render.dll">
    <Define Name="RenderComponent" Class="Kinectitude.Render.RenderComponent" />
    <Define Name="RenderManager" Class="Kinectitude.Render.RenderManager" />
    <Define Name="TextRenderComponent" Class="Kinectitude.Render.TextRenderComponent" />
    <Define Name="SetTextAction" Class="Kinectitude.Render.SetTextAction" />
  </Using>
  
  <Prototype Name="Paddle" score="0">
    <Component Type="TransformComponent" Width="24" Height="128" />
    <Component Type="KinectFollowComponent" Direction="Y" />
    <Component Type="RenderComponent" FillColor="LimeGreen" />
    <Component Type="PhysicsComponent" XVelocity="0" YVelocity="0" />
  </Prototype>

  <Prototype Name="PlayerOnePaddle" Prototype="Paddle">
    <Component Type="KinectFollowComponent" Player="P1" Joint="HandLeft" />
  </Prototype>

  <Prototype Name="PlayerTwoPaddle" Prototype="Paddle">
    <Component Type="KinectFollowComponent" Player="P1" Joint="HandRight" />
  </Prototype>

  <Prototype Name="Score">
    <Component Type="TextRenderComponent" FontColor="White" />
  </Prototype>

  <Prototype Name="Bar">
    <Component Type="TransformComponent" Width="800" Height="10" />
    <Component Type="RenderComponent" FillColor="LimeGreen" />
  </Prototype>

  <Scene Name="Main Menu" numReady="0">

    <Entity>
      <Component Type="TransformComponent" X="250" Y="24" />
      <Component Type="TextRenderComponent" Value="Kinect Wimbledon Deluxe" FontColor="Yellow" />
    </Entity>

    <Entity>
      <Component Type="TransformComponent" X="220" Y="80" />
      <Component Type="TextRenderComponent" Value="Move below the line to start" FontColor="White" />
    </Entity>

    <Entity>

      <Component Type="TransformComponent" X="25" Y="125" />
      <Component Type="TextRenderComponent" Value="Player 1 not ready!" FontColor="White" />
      
      <Event Type="TriggerOccursEvent" Trigger="Player1Ready">
        <Action Type="SetAction" Target="TextRenderComponent.Text" Value="Player 1 is ready!" />
      </Event>
    </Entity>

    <Entity>

      <Component Type="TransformComponent" X="425" Y="125" />
      <Component Type="TextRenderComponent" Value="Player 2 Not Ready!" FontColor="White" />
      
      <Event Type="TriggerOccursEvent" Trigger="Player2Ready">
        <Action Type="SetAction" Target="TextRenderComponent.Text" Value="Player 2 is ready!" />
      </Event>
    </Entity>

    <Entity Prototype="PlayerOnePaddle">

      <Component Type="TransformComponent" X="5" Y="250" />
      
      <Event Type="CrossesLineEvent" Line="Y" Location="450" Direction="Positive">
        <Action Type="FireTriggerAction" Name="Player1Ready" />
        <Action Type="IncrementAction" Target="scene.numReady" />
      </Event>
    </Entity>

    <Entity Prototype="PlayerTwoPaddle">

      <Component Type="TransformComponent" X="770" Y="250" />
      
      <Event Type="CrossesLineEvent" Line="Y" Location="450" Direction="Positive">
        <Condition If="scene.numReady &lt; 2">
          <Action Type="FireTriggerAction" Name="Player2Ready" />
          <Action Type="IncrementAction" Target="scene.numReady" />
        </Condition>
      </Event>
    </Entity>

    <Entity Prototype="Bar">
      <Component Type="TransformComponent" X="0" Y="450" />
    </Entity>

    <Entity>
      <Event Type="Event" Value="scene.numReady" Target="2">
        <Action Type="ChangeSceneAction" Target="Game" />
      </Event>
    </Entity>

  </Scene>
  
  <Scene Name="Game">
    
    <Entity Prototype="PlayerOnePaddle" Name="paddle1">

      <Component Type="TransformComponent" X="5" Y="250" />
      
      <Event Type="TriggerOccursEvent" Trigger="Player1Scores">
        <Action Type="IncrementAction" Target="score" />
      </Event>
    </Entity>

    <Entity Prototype="PlayerTwoPaddle" Name="paddle2">

      <Component Type="TransformComponent" X="770" Y="250" />
      
      <Event Type="TriggerOccursEvent" Trigger="Player2Scores">
        <Action Type="IncrementAction" Target="score" />
      </Event>
    </Entity>

    <Entity>

      <Component Type="TransformComponent" X="400" Y="300" Width="48" Height="48" />
      <Component Type="RenderComponent" FillColor="LimeGreen" Shape="Ellipse" />
      <Component Type="PhysicsComponent" XVelocity="6" YVelocity="6" />
      
      <Event Type="CrossesLineEvent" Line="X" Location="0" Direction="Negative">
        <Action Type="SetPositionAction" X="400" Y="300" />
        <Action Type="FireTriggerAction" Name="Player2Scores" />
      </Event>
      <Event Type="CrossesLineEvent" Line="X" Location="800" Direction="Positive">
        <Action Type="SetPositionAction" X="400" Y="300" />
        <Action Type="FireTriggerAction" Name="Player1Scores" />
      </Event>
    </Entity>

	<Entity Prototype="Score">
      <Component Type="TransformComponent" X="56" Y="24" />
      <Component Type="TextRenderComponent" Value="{paddle1.score}" />
    </Entity>
	
	<Entity Prototype="Score">
      <Component Type="TransformComponent" X="724" Y="24" />
      <Component Type="TextRenderComponent" Value="{paddle2.score}" />
	</Entity>

    <Entity>
        <Action Type="SetAction" Key="game.winner" Value="1" />
        <Action Type="ChangeSceneAction" Target="Game Over" />
      </Event>

      <Event Type="AttributeEqualsEvent" LS="paddle2.score" RS="7">
        <Action Type="SetAction" Key="game.winner" Value="2" />
        <Action Type="ChangeSceneAction" Target="Game Over" />
      </Event>
    </Entity>
    
  </Scene>

  <Scene Name="Game Over">
    
    <Entity>
      <Component Type="TransformComponent" X="300" Y="20" />
      <Component Type="TextRenderComponent" Value="Player {game.winner} Wins!" FontColor="White" />
    </Entity>

    <Entity>
      <Component Type="TransformComponent" X="100" Y="100" />
      <Component Type="TextRenderComponent" Value="Top line for menu, bottom to quit." FontColor="White" />
    </Entity>

    <Entity Prototype="PlayerOnePaddle">

      <Component Type="TransformComponent" X="5" Y="250" />
      
      <Event Type="CrossesLineEvent" Line="Y" Location="500" Direction="Positive">
        <Action Type="PopSceneAction" />
      </Event>
      <Event Type="CrossesLineEvent" Line="Y" Location="150" Direction="Negative">
        <Action Type="ChangeSceneAction" Target="Main Menu" />
      </Event>
    </Entity>

    <Entity Prototype="PlayerTwoPaddle">

      <Component Type="TransformComponent" X="770" Y="250" />

      <Event Type="CrossesLineEvent" Line="Y" Location="500" Direction="Positive">
        <Action Type="PopSceneAction" />
      </Event>
      <Event Type="CrossesLineEvent" Line="Y" Location="150" Direction="Negative">
        <Action Type="ChangeSceneAction" Target="Main Menu" />
      </Event>
    </Entity>

    <Entity Prototype="Bar">
      <Component Type="TransformComponent" X="0" Y="500" />
    </Entity>

    <Entity Prototype="Bar">
      <Component Type="TransformComponent" X="0" Y="150" />
    </Entity>
    
  </Scene>
</Game>